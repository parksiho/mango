<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mango Runner 2.0 🐶🌸</title>
<style>
  body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: linear-gradient(skyblue, lightgreen);
    font-family: Arial, sans-serif;
    touch-action: manipulation;
  }
  #gameCanvas {
    display: block;
    margin: auto;
    background: #87ceeb;
    max-width: 100vw;
    max-height: 100vh;
  }
  
  /* 모바일 화면 대응 */
  @media (max-width: 768px) {
    #gameCanvas {
      width: 100vw;
      height: 50vh;
    }
  }
  
  /* 터치 안내 메시지 */
  .touch-hint {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 10px 20px;
    border-radius: 20px;
    font-size: 14px;
    z-index: 1000;
    pointer-events: none;
  }
  
  @media (min-width: 769px) {
    .touch-hint {
      display: none;
    }
  }
</style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="300"></canvas>
<div class="touch-hint">화면을 터치해서 점프하세요!</div>
<audio id="bgm" loop autoplay>
  <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_7f1f03a2cf.mp3?filename=happy-day-110997.mp3" type="audio/mpeg">
</audio>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const bgm = document.getElementById("bgm");

// 모바일 화면 크기에 맞게 캔버스 크기 조정
function resizeCanvas() {
  const isMobile = window.innerWidth <= 768;
  if (isMobile) {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight * 0.5; // 화면 높이의 50%
  } else {
    canvas.width = 800;
    canvas.height = 300;
  }
}

// 초기 캔버스 크기 설정
resizeCanvas();

// 화면 크기 변경 시 캔버스 크기 재조정
window.addEventListener('resize', resizeCanvas);

let dog = { x: 50, y: canvas.height - 70, width: 50, height: 50, vy: 0, jumping: false };
let gravity = 0.8;
let obstacles = [];
let snacks = [];
let frame = 0;
let speed = 5;
let score = 0;
let gameOver = false;
let gameStarted = true;

// 구름 위치
let clouds = [
  { x: 100, y: 50 },
  { x: 400, y: 30 },
  { x: 700, y: 70 }
];

// 게임 재시작 함수
function restartGame() {
  // 모든 게임 상태 초기화
  dog = { x: 50, y: canvas.height - 70, width: 50, height: 50, vy: 0, jumping: false };
  obstacles = [];
  snacks = [];
  frame = 0;
  speed = 5;
  score = 0;
  gameOver = false;
  gameStarted = true;
  
  // 구름 위치도 초기화
  clouds = [
    { x: 100, y: 50 },
    { x: 400, y: 30 },
    { x: 700, y: 70 }
  ];
}

function drawBackground() {
  const groundY = canvas.height - 20;
  const skyHeight = groundY;
  
  // 하늘
  ctx.fillStyle = "#87ceeb";
  ctx.fillRect(0, 0, canvas.width, skyHeight);
  
  // 구름
  ctx.fillStyle = "white";
  for (let c of clouds) {
    ctx.beginPath();
    ctx.arc(c.x, c.y, 20, 0, Math.PI * 2);
    ctx.arc(c.x + 25, c.y + 10, 20, 0, Math.PI * 2);
    ctx.arc(c.x - 25, c.y + 10, 20, 0, Math.PI * 2);
    ctx.fill();
    c.x -= 1;
    if (c.x < -50) c.x = canvas.width + 50;
  }
  
  // 땅
  ctx.fillStyle = "#228B22";
  ctx.fillRect(0, groundY, canvas.width, 20);
}

function drawDog() {
  ctx.fillStyle = "#f4a460";
  ctx.beginPath();
  ctx.arc(dog.x + 25, dog.y + 25, 25, 0, Math.PI * 2);
  ctx.fill();
  ctx.fillStyle = "black";
  ctx.beginPath();
  ctx.arc(dog.x + 35, dog.y + 15, 5, 0, Math.PI * 2);
  ctx.fill();
}

function drawObstacles() {
  ctx.fillStyle = "#2e8b57";
  for (let o of obstacles) ctx.fillRect(o.x, o.y, o.width, o.height);
}

function drawSnacks() {
  ctx.fillStyle = "#ffa500";
  for (let s of snacks) {
    ctx.beginPath();
    ctx.arc(s.x, s.y, 10, 0, Math.PI * 2);
    ctx.fill();
  }
}

function update() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawBackground();

  // 게임 오버 상태가 아니면 게임 진행
  if (!gameOver) {
    // 강아지 점프
    dog.y += dog.vy;
    dog.vy += gravity;
    if (dog.y >= canvas.height - 70) {
      dog.y = canvas.height - 70;
      dog.vy = 0;
      dog.jumping = false;
    }

    // 장애물 생성
    if (frame % 90 === 0) {
      obstacles.push({ x: canvas.width, y: canvas.height - 50, width: 20, height: 30 });
    }

    // 간식 생성
    if (frame % 150 === 0) {
      snacks.push({ x: canvas.width, y: canvas.height - 100 });
    }

    // 이동
    for (let o of obstacles) o.x -= speed;
    for (let s of snacks) s.x -= speed;

    // 충돌
    for (let o of obstacles) {
      if (dog.x < o.x + o.width &&
          dog.x + dog.width > o.x &&
          dog.y < o.y + o.height &&
          dog.y + dog.height > o.y) {
        gameOver = true;
        const isMobile = window.innerWidth <= 768;
        const restartHint = isMobile ? "화면을 터치해서 다시 시작하세요!" : "스페이스바를 눌러 다시 시작하세요!";
        alert("💥 망고가 돌부리에 걸렸어요! 점수: " + score + "\n\n" + restartHint);
      }
    }

    // 간식 먹기
    for (let i = snacks.length - 1; i >= 0; i--) {
      let s = snacks[i];
      if (Math.abs(dog.x - s.x) < 30 && Math.abs(dog.y - s.y) < 30) {
        snacks.splice(i, 1);
        score += 50;
      }
    }

    // 점수 증가
    score++;
  }

  // 그리기
  drawDog();
  drawObstacles();
  drawSnacks();

  // 점수 표시
  ctx.fillStyle = "black";
  ctx.font = "20px Arial";
  ctx.fillText("점수: " + score, 10, 25);

  // 게임 오버 메시지 표시
  if (gameOver) {
    ctx.fillStyle = "red";
    ctx.font = "30px Arial";
    ctx.textAlign = "center";
    ctx.fillText("게임 오버!", canvas.width / 2, canvas.height / 2 - 20);
    ctx.fillStyle = "black";
    ctx.font = "16px Arial";
    const isMobile = window.innerWidth <= 768;
    const restartText = isMobile ? "화면을 터치해서 다시 시작" : "스페이스바를 눌러 다시 시작";
    ctx.fillText(restartText, canvas.width / 2, canvas.height / 2 + 20);
    ctx.textAlign = "left";
  }

  frame++;
  requestAnimationFrame(update);
}

// 점프 함수
function jump() {
  if (gameOver) {
    // 게임 오버 상태에서 점프하면 재시작
    restartGame();
  } else if (!dog.jumping) {
    // 게임 진행 중일 때는 점프
    dog.vy = -13;
    dog.jumping = true;
  }
}

// 키보드 이벤트
document.addEventListener("keydown", e => {
  if (e.code === "Space") {
    jump();
  }
});

// 터치 이벤트
document.addEventListener("touchstart", e => {
  e.preventDefault(); // 스크롤 방지
  jump();
});

// 마우스 클릭 이벤트 (데스크톱에서도 클릭으로 점프 가능)
document.addEventListener("click", e => {
  if (e.target === canvas) {
    jump();
  }
});

// 음악 자동 재생 시도
document.addEventListener("click", () => {
  bgm.play().catch(() => {});
});

update();
</script>
</body>
</html>