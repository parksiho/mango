<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mango Runner 2.0 ğŸ¶ğŸŒ¸</title>
<style>
  body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: linear-gradient(skyblue, lightgreen);
    font-family: Arial, sans-serif;
    touch-action: manipulation;
  }
  #gameCanvas {
    display: block;
    margin: auto;
    background: #87ceeb;
    max-width: 100vw;
    max-height: 100vh;
  }
  
  /* ëª¨ë°”ì¼ í™”ë©´ ëŒ€ì‘ */
  @media (max-width: 768px) {
    #gameCanvas {
      width: 100vw;
      height: 50vh;
    }
  }
  
  /* í„°ì¹˜ ì•ˆë‚´ ë©”ì‹œì§€ */
  .touch-hint {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 10px 20px;
    border-radius: 20px;
    font-size: 14px;
    z-index: 1000;
    pointer-events: none;
  }
  
  @media (min-width: 769px) {
    .touch-hint {
      display: none;
    }
  }
</style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="300"></canvas>
<div class="touch-hint">í™”ë©´ì„ í„°ì¹˜í•´ì„œ ì í”„í•˜ì„¸ìš”!</div>
<audio id="bgm" loop autoplay>
  <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_7f1f03a2cf.mp3?filename=happy-day-110997.mp3" type="audio/mpeg">
</audio>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const bgm = document.getElementById("bgm");

// ëª¨ë°”ì¼ í™”ë©´ í¬ê¸°ì— ë§ê²Œ ìº”ë²„ìŠ¤ í¬ê¸° ì¡°ì •
function resizeCanvas() {
  const isMobile = window.innerWidth <= 768;
  if (isMobile) {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight * 0.5; // í™”ë©´ ë†’ì´ì˜ 50%
  } else {
    canvas.width = 800;
    canvas.height = 300;
  }
}

// ì´ˆê¸° ìº”ë²„ìŠ¤ í¬ê¸° ì„¤ì •
resizeCanvas();

// í™”ë©´ í¬ê¸° ë³€ê²½ ì‹œ ìº”ë²„ìŠ¤ í¬ê¸° ì¬ì¡°ì •
window.addEventListener('resize', resizeCanvas);

let dog = { x: 50, y: canvas.height - 70, width: 50, height: 50, vy: 0, jumping: false, rotation: 0, doubleJumpUsed: false };
let gravity = 0.8;
let obstacles = [];
let snacks = [];
let coinSpawnCounter = 0; // ì½”ì¸ ìƒì„± ì¹´ìš´í„°
let frame = 0;
let speed = 4.5; // ê²Œì„ ì†ë„ë¥¼ 10% ëŠë¦¬ê²Œ ì¡°ì • (5 * 0.9 = 4.5)
let score = 0;
let gameOver = false;
let gameStarted = true;

// ë§ê³  ì´ë¯¸ì§€ ë¡œë“œ
let mangoImage = new Image();
let imageLoaded = false;
mangoImage.src = "https://raw.githubusercontent.com/parksiho/mango/main/mg1.png";
mangoImage.onload = function() {
  console.log("ë§ê³  ì´ë¯¸ì§€ ë¡œë“œ ì™„ë£Œ!");
  imageLoaded = true;
};
mangoImage.onerror = function() {
  console.log("ë§ê³  ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨ - ê¸°ë³¸ ëª¨ì–‘ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.");
  imageLoaded = false;
};

// êµ¬ë¦„ ìœ„ì¹˜
let clouds = [
  { x: 100, y: 50 },
  { x: 400, y: 30 },
  { x: 700, y: 70 }
];

// ê²Œì„ ì¬ì‹œì‘ í•¨ìˆ˜
function restartGame() {
  // ëª¨ë“  ê²Œì„ ìƒíƒœ ì´ˆê¸°í™”
  dog = { x: 50, y: canvas.height - 70, width: 50, height: 50, vy: 0, jumping: false, rotation: 0 };
  obstacles = [];
  snacks = [];
  coinSpawnCounter = 0;
  frame = 0;
  speed = 4.5; // ê²Œì„ ì†ë„ë¥¼ 10% ëŠë¦¬ê²Œ ì¡°ì •
  score = 0;
  gameOver = false;
  gameStarted = true;
  
  // êµ¬ë¦„ ìœ„ì¹˜ë„ ì´ˆê¸°í™”
  clouds = [
    { x: 100, y: 50 },
    { x: 400, y: 30 },
    { x: 700, y: 70 }
  ];
}

function drawBackground() {
  const groundY = canvas.height - 20;
  const skyHeight = groundY;
  
  // í•˜ëŠ˜
  ctx.fillStyle = "#87ceeb";
  ctx.fillRect(0, 0, canvas.width, skyHeight);
  
  // êµ¬ë¦„
  ctx.fillStyle = "white";
  for (let c of clouds) {
    ctx.beginPath();
    ctx.arc(c.x, c.y, 20, 0, Math.PI * 2);
    ctx.arc(c.x + 25, c.y + 10, 20, 0, Math.PI * 2);
    ctx.arc(c.x - 25, c.y + 10, 20, 0, Math.PI * 2);
    ctx.fill();
    c.x -= 1;
    if (c.x < -50) c.x = canvas.width + 50;
  }
  
  // ë•…
  ctx.fillStyle = "#228B22";
  ctx.fillRect(0, groundY, canvas.width, 20);
}

function drawDog() {
  if (imageLoaded && mangoImage.complete) {
    // ì´ë¯¸ì§€ê°€ ë¡œë“œëœ ê²½ìš° íšŒì „í•˜ì—¬ ê·¸ë¦¬ê¸°
    ctx.save();
    ctx.translate(dog.x + dog.width/2, dog.y + dog.height/2);
    ctx.rotate(dog.rotation);
    ctx.drawImage(mangoImage, -dog.width/2, -dog.height/2, dog.width, dog.height);
    ctx.restore();
  } else {
    // ì´ë¯¸ì§€ê°€ ë¡œë“œë˜ì§€ ì•Šì€ ê²½ìš° ê¸°ë³¸ ì›í˜•ìœ¼ë¡œ í‘œì‹œ
    ctx.fillStyle = "#f4a460";
    ctx.beginPath();
    ctx.arc(dog.x + 25, dog.y + 25, 25, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = "black";
    ctx.beginPath();
    ctx.arc(dog.x + 35, dog.y + 15, 5, 0, Math.PI * 2);
    ctx.fill();
  }
}

function drawObstacles() {
  ctx.fillStyle = "#2e8b57";
  for (let o of obstacles) ctx.fillRect(o.x, o.y, o.width, o.height);
}

function drawSnacks() {
  ctx.fillStyle = "#ffa500";
  for (let s of snacks) {
    ctx.beginPath();
    ctx.arc(s.x, s.y, 10, 0, Math.PI * 2);
    ctx.fill();
  }
}

function update() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawBackground();

  // ê²Œì„ ì˜¤ë²„ ìƒíƒœê°€ ì•„ë‹ˆë©´ ê²Œì„ ì§„í–‰
  if (!gameOver) {
    // ê°•ì•„ì§€ ì í”„
    dog.y += dog.vy;
    dog.vy += gravity;
    
    // ì í”„ ì¤‘ì¼ ë•Œ íšŒì „ ì• ë‹ˆë©”ì´ì…˜ (í•œ ë°”í€´ íšŒì „)
    if (dog.jumping) {
      dog.rotation += 0.3; // íšŒì „ ì†ë„ ì¡°ì ˆ
      if (dog.rotation >= Math.PI * 2) {
        dog.rotation = 0; // í•œ ë°”í€´ ì™„ë£Œ í›„ ì´ˆê¸°í™”
      }
    }
    
    if (dog.y >= canvas.height - 70) {
      dog.y = canvas.height - 70;
      dog.vy = 0;
      dog.jumping = false;
      dog.doubleJumpUsed = false; // ì°©ì§€ ì‹œ 2ë‹¨ ì í”„ ìƒíƒœ ì´ˆê¸°í™”
      dog.rotation = 0; // ì°©ì§€ ì‹œ íšŒì „ ì´ˆê¸°í™”
    }

    // ì¥ì• ë¬¼ ìƒì„±
    if (frame % 90 === 0) {
      obstacles.push({ x: canvas.width, y: canvas.height - 50, width: 20, height: 30 });
    }

    // ì½”ì¸ ìƒì„± ë¡œì§ ê°œì„  - ë§ì´/ì ê²Œ ë‚˜ì˜¤ëŠ” íŒ¨í„´ì„ ì ì ˆíˆ ì„ê¸°
    coinSpawnCounter++;
    
    // ì½”ì¸ ìƒì„± íŒ¨í„´: ì§§ì€ ê°„ê²©(ë§ì´)ê³¼ ê¸´ ê°„ê²©(ì ê²Œ)ì„ ì„ì–´ì„œ ìƒì„±
    let shouldSpawnCoin = false;
    
    if (coinSpawnCounter % 60 === 0) {
      // ì§§ì€ ê°„ê²©ìœ¼ë¡œ ì½”ì¸ ìƒì„± (ë§ì´ ë‚˜ì˜¤ëŠ” êµ¬ê°„)
      shouldSpawnCoin = true;
    } else if (coinSpawnCounter % 200 === 0) {
      // ê¸´ ê°„ê²©ìœ¼ë¡œ ì½”ì¸ ìƒì„± (ì ê²Œ ë‚˜ì˜¤ëŠ” êµ¬ê°„)
      shouldSpawnCoin = true;
    }
    
    if (shouldSpawnCoin) {
      // ì½”ì¸ ìœ„ì¹˜ë¥¼ ì¥ì• ë¬¼ê³¼ ë„ˆë¬´ ê°€ê¹ì§€ ì•Šê²Œ ì¡°ì •
      let coinY = canvas.height - 100;
      let coinX = canvas.width;
      
      // ì¥ì• ë¬¼ê³¼ì˜ ê±°ë¦¬ í™•ì¸ (ìµœì†Œ 100í”½ì…€ ì´ìƒ ë–¨ì–´ëœ¨ë¦¼)
      let tooCloseToObstacle = false;
      for (let obstacle of obstacles) {
        if (Math.abs(obstacle.x - coinX) < 100) {
          tooCloseToObstacle = true;
          break;
        }
      }
      
      // ì¥ì• ë¬¼ê³¼ ë„ˆë¬´ ê°€ê¹ì§€ ì•Šì„ ë•Œë§Œ ì½”ì¸ ìƒì„±
      if (!tooCloseToObstacle) {
        snacks.push({ x: coinX, y: coinY });
      }
    }

    // ì´ë™
    for (let o of obstacles) o.x -= speed;
    for (let s of snacks) s.x -= speed;

    // ì¶©ëŒ
    for (let o of obstacles) {
      if (dog.x < o.x + o.width &&
          dog.x + dog.width > o.x &&
          dog.y < o.y + o.height &&
          dog.y + dog.height > o.y) {
        gameOver = true;
        const isMobile = window.innerWidth <= 768;
        const restartHint = isMobile ? "í™”ë©´ì„ í„°ì¹˜í•´ì„œ ë‹¤ì‹œ ì‹œì‘í•˜ì„¸ìš”!" : "ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼ ëˆŒëŸ¬ ë‹¤ì‹œ ì‹œì‘í•˜ì„¸ìš”!";
        alert("ğŸ’¥ ë§ê³ ê°€ ëŒë¶€ë¦¬ì— ê±¸ë ¸ì–´ìš”! ì ìˆ˜: " + score + "\n\n" + restartHint);
      }
    }

    // ì½”ì¸ ë¨¹ê¸° - ì ìˆ˜ë¥¼ 100ì ì”© ì¶”ê°€
    for (let i = snacks.length - 1; i >= 0; i--) {
      let s = snacks[i];
      if (Math.abs(dog.x - s.x) < 30 && Math.abs(dog.y - s.y) < 30) {
        snacks.splice(i, 1);
        score += 100; // ì½”ì¸ ì ìˆ˜ë¥¼ 100ì ìœ¼ë¡œ ë³€ê²½
      }
    }

    // ì ìˆ˜ ì¦ê°€
    score++;
  }

  // ê·¸ë¦¬ê¸°
  drawDog();
  drawObstacles();
  drawSnacks();

  // ì ìˆ˜ í‘œì‹œ
  ctx.fillStyle = "black";
  ctx.font = "20px Arial";
  ctx.fillText("ì ìˆ˜: " + score, 10, 25);
  
  // ì´ë¯¸ì§€ ë¡œë“œ ìƒíƒœ í‘œì‹œ (ë””ë²„ê¹…ìš©)
  if (!imageLoaded) {
    ctx.fillStyle = "red";
    ctx.font = "12px Arial";
    ctx.fillText("ì´ë¯¸ì§€ ë¡œë”© ì¤‘...", 10, canvas.height - 10);
  }

  // ê²Œì„ ì˜¤ë²„ ë©”ì‹œì§€ í‘œì‹œ
  if (gameOver) {
    ctx.fillStyle = "red";
    ctx.font = "30px Arial";
    ctx.textAlign = "center";
    ctx.fillText("ê²Œì„ ì˜¤ë²„!", canvas.width / 2, canvas.height / 2 - 20);
    ctx.fillStyle = "black";
    ctx.font = "16px Arial";
    const isMobile = window.innerWidth <= 768;
    const restartText = isMobile ? "í™”ë©´ì„ í„°ì¹˜í•´ì„œ ë‹¤ì‹œ ì‹œì‘" : "ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼ ëˆŒëŸ¬ ë‹¤ì‹œ ì‹œì‘";
    ctx.fillText(restartText, canvas.width / 2, canvas.height / 2 + 20);
    ctx.textAlign = "left";
  }

  frame++;
  requestAnimationFrame(update);
}

// ì í”„ í•¨ìˆ˜ - 2ë‹¨ ì í”„ êµ¬í˜„
function jump() {
  if (gameOver) {
    // ê²Œì„ ì˜¤ë²„ ìƒíƒœì—ì„œ ì í”„í•˜ë©´ ì¬ì‹œì‘
    restartGame();
  } else if (!dog.jumping) {
    // ì²« ë²ˆì§¸ ì í”„
    dog.vy = -13;
    dog.jumping = true;
    dog.doubleJumpUsed = false;
  } else if (dog.jumping && !dog.doubleJumpUsed) {
    // ë‘ ë²ˆì§¸ ì í”„ (2ë‹¨ ì í”„)
    dog.vy = -13;
    dog.doubleJumpUsed = true;
  }
}

// í‚¤ë³´ë“œ ì´ë²¤íŠ¸
document.addEventListener("keydown", e => {
  if (e.code === "Space") {
    jump();
  }
});

// í„°ì¹˜ ì´ë²¤íŠ¸
document.addEventListener("touchstart", e => {
  e.preventDefault(); // ìŠ¤í¬ë¡¤ ë°©ì§€
  jump();
});

// ë§ˆìš°ìŠ¤ í´ë¦­ ì´ë²¤íŠ¸ (ë°ìŠ¤í¬í†±ì—ì„œë„ í´ë¦­ìœ¼ë¡œ ì í”„ ê°€ëŠ¥)
document.addEventListener("click", e => {
  if (e.target === canvas) {
    jump();
  }
});

// ìŒì•… ìë™ ì¬ìƒ ì‹œë„
document.addEventListener("click", () => {
  bgm.play().catch(() => {});
});

update();
</script>
</body>
</html>